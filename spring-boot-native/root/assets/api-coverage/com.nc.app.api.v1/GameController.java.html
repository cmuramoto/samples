<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GameController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">root::app</a> &gt; <a href="index.source.html" class="el_package">com.nc.app.api.v1</a> &gt; <span class="el_source">GameController.java</span></div><h1>GameController.java</h1><pre class="source lang-java linenums">package com.nc.app.api.v1;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;

import com.nc.domain.base.FrontEndTranslatedError;
import com.nc.domain.frontend.api.v1.ApiConstraints;
import com.nc.domain.frontend.api.v1.ApiRound;
import com.nc.domain.frontend.api.v1.ApiUser;
import com.nc.domain.frontend.api.v1.FinishMatchRequest;
import com.nc.domain.frontend.api.v1.FinishMatchResponse;
import com.nc.domain.frontend.api.v1.FinishRoundRequest;
import com.nc.domain.frontend.api.v1.FinishRoundResponse;
import com.nc.domain.frontend.api.v1.GetOrStartGameRequest;
import com.nc.domain.frontend.api.v1.GetOrStartGameResponse;
import com.nc.domain.frontend.api.v1.TopPlayerRequest;
import com.nc.domain.frontend.api.v1.TopPlayerResponse;
import com.nc.domain.frontend.services.v1.MovieGameService;
import com.nc.domain.internal.DomainException;

import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.media.Content;
import io.swagger.v3.oas.annotations.media.Schema;
import io.swagger.v3.oas.annotations.responses.ApiResponse;
import io.swagger.v3.oas.annotations.responses.ApiResponses;

@RestController
@RequestMapping(&quot;/v1/game&quot;)
@CrossOrigin
<span class="fc" id="L37">public class GameController {</span>

	@Autowired
	MovieGameService gameService;

	@Operation(summary = &quot;Changes the game's constraints (maxRounds,maxErrors)&quot;)
	@ApiResponses({ //
			@ApiResponse( //
					responseCode = &quot;200&quot;, //
					description = &quot;Value updated successfully&quot;, //
					content = @Content(schema = @Schema(implementation = ApiConstraints.class))), //
			@ApiResponse( //
					responseCode = &quot;417&quot;, //
					description = &quot;maxRounds &lt; 1 || maxErrors &lt; 1&quot;, //
					content = @Content(schema = @Schema(implementation = FrontEndTranslatedError.class))) //
	})
	@RequestMapping(value = &quot;/constraints&quot;, method = RequestMethod.POST)
	public ResponseEntity&lt;ApiConstraints&gt; changeConstraints(@RequestBody ApiConstraints request) throws Exception {
<span class="fc" id="L55">		return ResponseEntity.ok(gameService.changeConstraints(request));</span>
	}

	@Operation(summary = &quot;Fetch current authenticated user information&quot;)
	@ApiResponses({ //
			@ApiResponse( //
					responseCode = &quot;200&quot;, //
					description = &quot;Authenticated user ranking information&quot;, //
					content = @Content(schema = @Schema(implementation = ApiUser.class))//
			), //
			@ApiResponse( //
					responseCode = &quot;417&quot;, //
					description = &quot;Unlikelly (e.g. user was deleted after authentication layer and before service layer)&quot;, //
					content = @Content(schema = @Schema(implementation = FrontEndTranslatedError.class))//
			) //
	})
	@RequestMapping(value = &quot;/me&quot;, method = RequestMethod.GET)
	public ResponseEntity&lt;ApiUser&gt; findAuthenticatedUserInfo() throws Exception {
<span class="fc" id="L73">		return ResponseEntity.ok(gameService.me());</span>
	}

	@Operation(summary = &quot;Find current round that user is playing&quot;)
	@ApiResponses({ //
			@ApiResponse( //
					responseCode = &quot;200&quot;, //
					description = &quot;Finds the pair of movies for the active round of a match. Returns an empty object if user has no active match&quot;, //
					content = @Content(schema = @Schema(implementation = ApiRound.class))), //
			@ApiResponse( //
					responseCode = &quot;417&quot;, //
					description = &quot;The movie associated with the current round was deleted&quot;, //
					content = @Content(schema = @Schema(implementation = FrontEndTranslatedError.class))) //
	})
	@RequestMapping(value = &quot;/round/current&quot;, method = RequestMethod.GET)
	public ResponseEntity&lt;ApiRound&gt; findCurrentRound() throws Exception {
<span class="fc" id="L89">		return ResponseEntity.ok(gameService.current());</span>
	}

	@Operation(summary = &quot;Retrieves the current match in play or create a new one if user has no active match associated&quot;)
	@ApiResponses({ //
			@ApiResponse( //
					responseCode = &quot;200&quot;, //
					description = &quot;Finishes current round with user selection. Returns either new round if rounds played &lt; 10 or the match summary if request was for the last round&quot;, //
					content = @Content(schema = @Schema(implementation = FinishMatchResponse.class))), //
			@ApiResponse( //
					responseCode = &quot;417&quot;, //
					description = &quot;If category is not supported or there are not enough movies in the database to satisfy a match of 10 rounds&quot;, //
					content = @Content(schema = @Schema(implementation = FrontEndTranslatedError.class))) //
	})
	@RequestMapping(value = &quot;/finish&quot;, method = RequestMethod.POST)
	public ResponseEntity&lt;FinishMatchResponse&gt; finishMatch(@RequestBody FinishMatchRequest request) throws Exception {
<span class="fc" id="L105">		return ResponseEntity.ok(gameService.finish(request));</span>
	}

	@Operation(summary = &quot;Retrieves the current match in play or create a new one if user has no active match associated&quot;)
	@ApiResponses({ //
			@ApiResponse( //
					responseCode = &quot;200&quot;, //
					description = &quot;Finishes current round with user selection. Returns either new round if rounds played &lt; 10 or the match summary if request was for the last round&quot;, //
					content = @Content(schema = @Schema(implementation = FinishRoundResponse.class))), //
			@ApiResponse( //
					responseCode = &quot;417&quot;, //
					description = &quot;If category is not supported or there are not enough movies in the database to satisfy a match of 10 rounds&quot;, //
					content = @Content(schema = @Schema(implementation = FrontEndTranslatedError.class))) //
	})
	@RequestMapping(value = &quot;/round/finish&quot;, method = RequestMethod.POST)
	public ResponseEntity&lt;FinishRoundResponse&gt; finishRound(@RequestBody FinishRoundRequest request) throws Exception {
<span class="fc" id="L121">		return ResponseEntity.ok(gameService.finish(request));</span>
	}

	@Operation(summary = &quot;Fetches the game constraints (maxRounds,maxErrors)&quot;)
	@ApiResponses({ //
			@ApiResponse( //
					responseCode = &quot;200&quot;, //
					description = &quot;Value updated successfully&quot;, //
					content = @Content(schema = @Schema(implementation = ApiConstraints.class))), //
			@ApiResponse( //
					responseCode = &quot;417&quot;, //
					description = &quot;maxRounds &lt; 1 || maxErrors &lt; 1&quot;, //
					content = @Content(schema = @Schema(implementation = FrontEndTranslatedError.class))) //
	})
	@RequestMapping(value = &quot;/constraints&quot;, method = RequestMethod.GET)
	public ResponseEntity&lt;ApiConstraints&gt; getConstraints() throws Exception {
<span class="fc" id="L137">		return ResponseEntity.ok(gameService.getConstraints());</span>
	}

	@ExceptionHandler({ DomainException.class })
	public ResponseEntity&lt;Object&gt; onException(DomainException de) {
<span class="fc" id="L142">		return ResponseEntity.status(HttpStatus.EXPECTATION_FAILED).body(de.getTranslation());</span>
	}

	@Operation(summary = &quot;Fetches players ordered by ranking&quot;)
	@ApiResponses({ //
			@ApiResponse( //
					responseCode = &quot;200&quot;, //
					description = &quot;Value updated successfully&quot;, //
					content = @Content(schema = @Schema(implementation = TopPlayerResponse.class))), //
			@ApiResponse( //
					responseCode = &quot;417&quot;, //
					description = &quot;maxRounds &lt; 1 || maxErrors &lt; 1&quot;, //
					content = @Content(schema = @Schema(implementation = FrontEndTranslatedError.class))) //
	})
	@RequestMapping(value = &quot;/top&quot;, method = RequestMethod.POST)
	public ResponseEntity&lt;TopPlayerResponse&gt; ranking(@RequestBody TopPlayerRequest request) throws Exception {
<span class="fc" id="L158">		return ResponseEntity.ok(gameService.top(request));</span>
	}

	@Operation(summary = &quot;Retrieves the current match in play or create a new one if user has no active match associated&quot;)
	@ApiResponses({ //
			@ApiResponse( //
					responseCode = &quot;200&quot;, //
					description = &quot;Gets active match in play by the current user or creates a new one if the user has no active matches&quot;, //
					content = @Content(schema = @Schema(implementation = GetOrStartGameResponse.class))), //
			@ApiResponse( //
					responseCode = &quot;417&quot;, //
					description = &quot;If category is not supported or there are not enough movies in the database to satisfy a match of 10 rounds&quot;, //
					content = @Content(schema = @Schema(implementation = FrontEndTranslatedError.class))) //
	})
	@RequestMapping(value = &quot;/start&quot;, method = RequestMethod.POST)
	public ResponseEntity&lt;GetOrStartGameResponse&gt; startOrRetrieve(@RequestBody GetOrStartGameRequest request) throws Exception {
<span class="fc" id="L174">		return ResponseEntity.ok(gameService.start(request));</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>